import timeit
import numpy as np

setup = """
import polars as pl
import random
import string
from my_plugin import (
    pig_latinnify_allocating,
    pig_latinnify_amortized,
    pig_latinnify_with_builder,
)

size = 100_000
data = []
for _ in range(size):
    data.append(''.join(random.choices(string.ascii_letters, k=10)))

df = pl.DataFrame({'a': data})
"""

print('- pig_latinnify_allocating')
results = np.array(timeit.Timer(
    stmt="df.select(pig_latinnify_allocating('a'))",
    setup=setup,
    )
    .repeat(7, 3)
)/3
print(f"  - min: {min(results)}")
print(f"  - {np.mean(results)} +/- {np.std(results)/np.sqrt(len(results))}")
print()

print('- pig_latinnify_amortized')
results = np.array(timeit.Timer(
    stmt="df.select(pig_latinnify_amortized('a'))",
    setup=setup,
    )
    .repeat(7, 3)
)/3
print(f"  - min: {min(results)}")
print(f"  - {np.mean(results)} +/- {np.std(results)/np.sqrt(len(results))}")
print()

print('- pig_latinnify_with_builder')
results = np.array(timeit.Timer(
    stmt="df.select(pig_latinnify_with_builder('a'))",
    setup=setup,
    )
    .repeat(7, 3)
)/3
print(f"  - min: {min(results)}")
print(f"  - {np.mean(results)} +/- {np.std(results)/np.sqrt(len(results))}")
