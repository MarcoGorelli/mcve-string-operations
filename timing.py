import timeit
import numpy as np

setup = """
import polars as pl
import random
import string
import numpy as np
from my_plugin import (
    pig_latinnify_allocating,
    pig_latinnify_amortized,
    pig_latinnify_with_builder,
    numeric_op_allocating,
    numeric_op_with_builder,
)

rng = np.random.default_rng(1)
size = 100_000
data = []
for _ in range(size):
    data.append(''.join(random.choices(string.ascii_letters, k=10)))

df = pl.DataFrame({
    'a': data,
    'b': rng.integers(-100, 100, size=size)
})
"""

print('- pig_latinnify_allocating')
results = np.array(timeit.Timer(
    stmt="df.select(pig_latinnify_allocating('a'))",
    setup=setup,
    )
    .repeat(7, 3)
)/3
print(f"  - min: {min(results)}")
print(f"  - {np.mean(results)} +/- {np.std(results)/np.sqrt(len(results))}")
print()

print('- pig_latinnify_amortized')
results = np.array(timeit.Timer(
    stmt="df.select(pig_latinnify_amortized('a'))",
    setup=setup,
    )
    .repeat(7, 3)
)/3
print(f"  - min: {min(results)}")
print(f"  - {np.mean(results)} +/- {np.std(results)/np.sqrt(len(results))}")
print()

print('- pig_latinnify_with_builder')
results = np.array(timeit.Timer(
    stmt="df.select(pig_latinnify_with_builder('a'))",
    setup=setup,
    )
    .repeat(7, 3)
)/3
print(f"  - min: {min(results)}")
print(f"  - {np.mean(results)} +/- {np.std(results)/np.sqrt(len(results))}")
print()

print('- numeric_op_allocating')
results = np.array(timeit.Timer(
    stmt="df.select(numeric_op_allocating('b'))",
    setup=setup,
    )
    .repeat(7, 3)
)/3
print(f"  - min: {min(results)}")
print(f"  - {np.mean(results)} +/- {np.std(results)/np.sqrt(len(results))}")
print()

print('- numeric_op_with_builder')
results = np.array(timeit.Timer(
    stmt="df.select(numeric_op_with_builder('b'))",
    setup=setup,
    )
    .repeat(7, 3)
)/3
print(f"  - min: {min(results)}")
print(f"  - {np.mean(results)} +/- {np.std(results)/np.sqrt(len(results))}")
print()

